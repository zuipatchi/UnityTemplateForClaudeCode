---
name: architecture-design
description: Unityゲームのアーキテクチャ設計書を作成するための詳細ガイドとテンプレート。アーキテクチャ設計時にのみ使用。
allowed-tools: Read, Write
---

# Unity ゲーム アーキテクチャ設計スキル

このスキルは、Unityゲームの高品質なアーキテクチャ設計書を作成するための詳細ガイドです。

## 前提条件

アーキテクチャ設計を開始する前に、以下を確認してください:

### 必須ドキュメント

1. `docs/product-requirements.md` (PRD)
2. `docs/functional-design.md` (機能設計書)

アーキテクチャ設計は、PRDの要件と機能設計を技術的に実現するための
システム構造とUnity固有のテクノロジースタックを定義します。

## 既存ドキュメントの優先順位

**重要**: `docs/architecture.md` に既存のアーキテクチャ設計書がある場合、
以下の優先順位に従ってください:

1. **既存のアーキテクチャ設計書 (`docs/architecture.md`)** - 最優先
   - プロジェクト固有の技術選定と設計が記載されている
   - このスキルのガイドより優先する

2. **このスキルのガイド** - 参考資料
   - Unity向けのテンプレートと例
   - 既存設計書がない場合、または補足として使用

**新規作成時**: このスキルのテンプレートとガイドを参照
**更新時**: 既存設計書の構造と内容を維持しながら更新

## 出力先

作成したアーキテクチャ設計書は以下に保存してください:

```
docs/architecture.md
```

## テンプレートの参照

アーキテクチャ設計書を作成する際は、次のガイドを参照しながら、テンプレートを使用してください:
- ガイド: ./guide.md
- テンプレート: ./template.md

## アーキテクチャ設計プロセス

### 1. 必須ドキュメントの確認

```bash
Read('docs/product-requirements.md')
Read('docs/functional-design.md')
Read('CLAUDE.md')
```

### 2. プロジェクト構成の把握

既存のスクリプト・アセット構成を確認します:

```bash
Read('Assets/Scripts/')
```

### 3. アーキテクチャ設計書の作成

ガイドとテンプレートに従い、以下の順序で設計書を作成します:

1. テクノロジースタック（Unity バージョン・URP・主要パッケージ）
2. レイヤードアーキテクチャ（Presentation / Domain / Infrastructure）
3. アセンブリ定義（.asmdef）の構成
4. データ永続化戦略（セーブ・ロードの方式）
5. パフォーマンス要件（フレームレート・メモリ・ドローコール）
6. テスト戦略（EditModeテストの対象と方針）

### 4. 設計書のレビューと改善

生成された設計書を以下の観点でレビューします:

#### レビュー観点

1. Unity / URP のバージョンと選定理由が明記されているか
2. レイヤー分離が守られているか（Domain層にUnityEngine依存がないか）
3. アセンブリ定義（.asmdef）がCLAUDE.mdの構成と整合しているか
4. パフォーマンス要件が具体的な数値で記述されているか
5. EditModeテストの対象が明確か
6. ScriptableObjectの活用方針が記載されているか

#### レビュー結果の評価基準

**✅ 強み**
- Domain層が純粋C#で実装され、UnityEngine非依存になっている
- アセンブリ定義がCLAUDE.mdのプロジェクト構成と一致している
- パフォーマンス要件がフレームレートとメモリで数値化されている

**⚠️ 改善が必要な点**

レイヤー分離の違反:
- 問題: Domain層にMonoBehaviourやUnityEngine名前空間が混入している
- 推奨: ゲームロジックは純粋C#クラスに分離し、MonoBehaviourはPresentation層のみに限定

パフォーマンス要件の曖昧さ:
- 問題: 「軽快に動作する」など数値のない表現がある
- 推奨: 60fps、メモリ512MB以下、ドローコール100以下など数値で明記

### 5. レビュー後の改善

1. 指摘された問題を一つずつ確認
2. 具体化が必要な箇所を改善
3. 改善後、再度レビューを実施
4. 問題がなくなるまで繰り返す

**注意点**:
- レイヤー設計はゲームの規模に合わせてシンプルに保つ
- 過剰な抽象化はUnityゲームでは逆効果になる場合がある
- 最終的な技術判断はユーザーが行う

## まとめ

Unity向けアーキテクチャ設計の成功のポイント:

1. **PRD・機能設計書をベースに設計**: 要件から逸脱した設計をしない
2. **Domain層をUnityEngine非依存に保つ**: テスト可能性と移植性を確保
3. **CLAUDE.mdのアセンブリ構成に準拠**: `Sample` / `Tests.EditMode` の構成を維持
4. **パフォーマンスを数値で定義**: フレームレート・メモリ・ドローコール
5. **EditModeテスト前提の設計**: Domain層はMonoBehaviourなしでテスト可能にする
6. **ScriptableObjectをデータ定義に活用**: マジックナンバーを排除しインスペクターで調整可能にする
7. **URP設定を明記**: `Assets/Settings/` のPC / Mobile 向け設定分離を反映する
